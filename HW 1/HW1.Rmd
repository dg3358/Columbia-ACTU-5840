# Homework 1 - Predictive Modeling in Finance and Insurance

# By: Dennis Goldenberg

```{r echo, include = TRUE}
# import packages
library(ggplot2)
library(patchwork)
library(MASS)
```

## 1. Automobile Insurance Claims

```{r, include = TRUE}
# read in Data
auto <- read.table(file = 'AutoClaims-1.csv', header = TRUE, sep = ',')
auto$state <- factor(auto$state, ordered = TRUE)
auto$gender <- factor(auto$gender)
auto$class <- factor(auto$class)
```

### 1a.

I compute the descriptive statistics for the "PAID" variable:

```{r, inlcude = TRUE}
summary(auto$paid)
```

So, the mean paid is \$1,853.00 and the median paid is \$1,001.70.

### 1b.

I graph the histogram and qqplot of "paid", comparing quantiles:

```{r, include = TRUE}
hist <- ggplot(data = auto) + 
        geom_histogram(aes(paid), binwidth = 1000) +
        labs(title = "Histogram of Payouts") + 
        theme(plot.title = element_text(hjust = 0.5))
qq <- ggplot(data = auto) + geom_qq(aes(sample = paid)) +
      geom_qq_line(aes(sample = paid)) +
      labs(x = "Standard Normal Quantiles", y = 'Quantiles, Paid') + 
      labs(title = 'QQ plot') + 
      theme(plot.title = element_text(hjust = 0.5))
hist + plot_spacer() + qq + plot_layout(widths = c(6,0.5,6))
```

The qqplot suggests that the normal distribution is not a good fit. Based on the histogram, the distribution of paid looks right-skewed, and potentially $\textbf{lognormal}$.

### 1c.

I graph the histogram and qqplot of "logpaid", comparing quantiles:

```{r, include = TRUE}
hist <- ggplot(data = auto) + 
        geom_histogram(aes(logpaid), binwidth = 0.25) +
        labs(title = "Histogram of Payouts") + 
        theme(plot.title = element_text(hjust = 0.5))
qq <- ggplot(data = auto) + geom_qq(aes(sample = logpaid)) +
      geom_qq_line(aes(sample = logpaid)) +
    labs(x = "Standard Normal Quantiles", y = 'Quantiles, logPaid') +
      labs(title = 'QQ plot') + 
      theme(plot.title = element_text(hjust = 0.5))
hist + plot_spacer() + qq + plot_layout(widths = c(6,0.5,6))
```

Based on the good fit in the qqplot, and the general shape in the histogram, the distribution of "logpaid" seems to be $\textbf{approximately normal}$. This would suggest that the distribution of paid is $\textbf{lognormal}$.

### 1d.

I graph the scatterplot of "logpaid" against "age":

```{r, inlcude = TRUE}
scat <- ggplot(data = auto) + geom_point(aes(x = age, y = logpaid)) +
        labs(title = "Natural log of Paid Amount vs. age") +
        theme(plot.title = element_text(hjust = 0.5))
scat
```

This plot suggests that the variance of log payments for individuals on the younger side (closer to 50) is higher than the variance of payments for older individuals; outside of this, however, there appears to be $\textbf{no discernable relationship}$ between the natural log of the paid amount for an automobile insurance claim and the age of an individual.

### 1e.

I account for gender in the next scatter plot:

```{r, inlcude = TRUE}
scat <- ggplot(data = auto) + 
        geom_point(aes(x = age, y = logpaid, color = gender)) +
        labs(title = "Natural log of Paid Amount vs. age") +
        theme(plot.title = element_text(hjust = 0.5))
scat
```

Based on the scatter plot above, there is $\textbf{no discernable relationship}$ between the natural log of the paid amount for an automobile insurance claim and the gender of an individual.

## 2. Boston Housing Dataset

### 2a.

I first show to pairwise scatter plots of all combinations of variables:

```{r, include = TRUE}
pairs(Boston, col = 'blue')
```

This output is too small to discern any patterns; I look at the correlation matrix to see which scatter plots may have a strong relationship. I find where the correlations are strongest by generating a correlation matrix and breaking it into two to see all columns:

```{r, include = TRUE}
cormatrix <- cor(Boston)
twocor <- matrix(as.numeric(sprintf(cormatrix, fmt = '%#.2f')), nrow = dim(cormatrix)[1])
rownames(twocor) <- rownames(cormatrix)
colnames(twocor) <- colnames(cormatrix)
twocor[,1:7]
```

```{r, include = TRUE}
twocor[,8:14]
```

I pick the 6 pairs with the highest correlation to plot:

```{r, include = TRUE}
radtax <- ggplot(Boston) + geom_point(aes(x = rad, y = tax))
noxdis <- ggplot(Boston) + geom_point(aes(x = nox, y = dis))
noxindus <- ggplot(Boston) + geom_point(aes(x = nox, y = indus))
agedis <- ggplot(Boston) + geom_point(aes(x = age, y = dis))
lstatmedv <- ggplot(Boston) + geom_point(aes(x = lstat, y = medv))
noxage <- ggplot(Boston) + geom_point(aes(x = nox, y = age))

(radtax+plot_spacer()+noxdis+plot_layout(widths = c(6,0.5,6)))/
  plot_spacer()/
  (noxindus+plot_spacer()+agedis+plot_layout(widths = c(6,0.5,6)))/
  plot_spacer()/
  (lstatmedv+plot_spacer()+noxage+plot_layout(widths = c(6,0.5,6))) +
  plot_layout(heights = c(6, 0.5, 6, 0.5, 6))
```

Here, it is notable that "rad", or accessibility to highways, is $\textbf{directly related}$ with "tax", or property tax rate per \$10,000. Further, "nox", or nitric oxide concentration, is $\textbf{inversely related}$ with "dis", or distance to employment centers with the relationship looking like exponential decay, but $\textbf{directly related}$ with "indus", or proportion of non-retail business acres, and "age", or proportion of buildings built before 1940. Finally, "dis" is $\textbf{inversely related}$ with "age", and "medv", or the median value of owner occupied homes, is $\textbf{inversely related}$ to "lstat", or percent of the population in lower status.

### 2b.

I check the correlation matrix with regards to crime rate:

```{r, include = TRUE}
twocor[1:7,'crim']
twocor[8:14,'crim']
```

I pick the 6 variables with the strongest correlation (excluding nox, to be evaluated later):

```{r, include = TRUE}
crimrad <- ggplot(Boston) + geom_point(aes(x = rad, y = crim))
crimtax <- ggplot(Boston) + geom_point(aes(x = tax, y = crim))
crimlstat <- ggplot(Boston) + geom_point(aes(x = lstat, y = crim))
crimindus <- ggplot(Boston) + geom_point(aes(x = indus, y = crim))
crimblack <- ggplot(Boston) + geom_point(aes(x = black, y = crim))
crimmedv <- ggplot(Boston) + geom_point(aes(x = medv, y = crim))

(crimrad+plot_spacer()+crimtax+plot_layout(widths = c(6,0.5,6)))/
  plot_spacer()/
  (crimlstat+plot_spacer()+crimindus+plot_layout(widths = c(6,0.5,6)))/
  plot_spacer()/
  (crimblack+plot_spacer()+crimmedv+plot_layout(widths = c(6,0.5,6))) +
  plot_layout(heights = c(6, 0.5, 6, 0.5, 6))
```

The strongest relationships with per capital crime rate, according to these graphs, are 'lstat", 'black', and 'medv'. It seems as though there is a $\textbf{direct relationship}$ between 'lstat' and the crime rate; that is, the higher the proportion of a population is of lower status, the higher there are crime rates. Meanwhile, though these relationships appear weaker, there is an $\textbf{inverse relationship}$ between crime rates and the proportion of population that is black and the median value of owner occupied homes. I next graph some of the other variables with relation to crim to see if there is a relationship:

```{r, include = TRUE}
crimnox <- ggplot(data = Boston) + geom_point(aes(x = nox, y = crim))
crimdis <- ggplot(data = Boston) + geom_point(aes(x = dis, y = crim))
crimage <- ggplot(data = Boston) + geom_point(aes(x = age, y = crim))
crimr <- ggplot(data = Boston) + geom_point(aes(ptratio,crim))
((crimnox+plot_spacer()+crimdis+plot_layout(widths = c(6,0.5,6)))/
  plot_spacer()/
  (crimage+plot_spacer()+crimr+plot_layout(widths = c(6,0.5,6))))+
  plot_layout(heights = c(6, 0.5, 6))
```

Here, it appears as though crime rate has a $\textbf{direct relationship}$ with nitric oxide concentration; the areas with the highest crime rates tend to have higher crime rates; it is also true that the areas with the highest crime rates tend to have higher proportions of buildings built before 1940. Alternatively, the crime rate seems to be $\textbf{inversely related}$ to distance to employment centers; the areas closest to the employment centers tend to have the highest crime rates.
